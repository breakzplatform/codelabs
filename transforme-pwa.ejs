<!doctype html>
<html>

<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>üéâTransforme seu site em um Progressive Web App üê≤</title>
  <script src="https://codelabs.developers.google.com/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <link rel="import" href="https://codelabs.developers.google.com/elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style>
    body {
      font-family: "Roboto", sans-serif;
    }
  </style>

</head>

<body unresolved class="fullbleed">

  <google-codelab title="üéâ Transforme seu site em um Progressive Web App üê≤" environment="web" feedback-link="https://github.com/googlecodelabs/migrate-to-progressive-web-apps/issues">

    <google-codelab-step label="Vis√£o Geral" duration="1">

      <p><a href="https://www.google.com/search?q=progressive+web+apps" target="_blank">Progressive Web Apps</a> s√£o legais e tal, mas e agora? Vamos migrar um site existente, feito apenas para desktop, para suportar as inc√≠veis funcionalidades dos PWAs</p>

      <h3 class="checklist"><strong>O que voc√™ vai aprender</strong></h3>
      <ul class="checklist">
        <li>Como migrar um site existente para um PWA de maneira r√°pida</li>
        <li>Como fornecer uma experi√™ncia mobile-friendly</li>
        <li>Como criar um Manifesto para seu PWA</li>
        <li>Como garantir que seus usu√°rios engajados vejam os banners de instala√ß√£o</li>
        <li>Como enviar notifica√ß√µes via Push para seus usu√°rios</li>
        <li>Como Supporting static and dynamic content offline</li>
      </ul>
      <h3><strong>O que voc√™ vai precisar</strong></h3>
      <ul>
        <li>Chrome 52 ou superior</li>
        <li>(opicional) um dispositivo Android rodando com Chrome 52 ou superior</li>
        <li>Entendimento b√°sico de <a href="http://git-scm.com/" target="_blank">git</a> e de como utilizar <a href="https://developer.chrome.com/devtools"
            target="_blank">Chrome DevTools</a></li>
        <li>O c√≥digo de exemplo (que ser√° fornecido nesse Codelab)</li>
        <li>Um editor de texto de sua prefer√™ncia (VSCode recomendado)</li>
      </ul>
      <p>Quando poss√≠vel, esse codelab ir√° simplificar algumas explica√ß√µes e caminhos para facilitar o entendimento. Essas explica√ß√µes
        podem ser vistas com mais profundidades em outros codelabs dedicados √† mesma. Seguindo as etapas passo-a-passo no
        c√≥digo do website fornecido nesse codelab, voc√™ vai aprender como aplicar nos seus pr√≥prios sites.</p>
      <h2>O in√≠cio de tudo</h2>
      <p>Voc√™ ir√° modificar um site chamado <strong>Dragotchi</strong>, onde voc√™ brinca com uma esp√©cie de bichinho virtual
        (em espec√≠fico, um drag√£o amig√°vel). Este site possui tr√™s p√°ginas (Home, Dragotchi e FAQ). Duas p√°ginas s√£o est√°ticas,
        mas a p√°gina Dragotchi faz algumas requisi√ß√µes Ajax simples √† um servidor.</p>
      <p>Esse site foi pensado apenas para navegadores desktop. Ele n√£o possui desing responsivo, e tamb√©m n√£o tem uma cara
        muito boa. Mas tudo bem! N√≥s estamos apenas √†lguns passos para melhorar isso.</p>
      <p><img style="max-width: 414.50px" src="img/2d0a26d3fd831a3e.png"></p>
      <aside class="special">
        <p>Voc√™ pode completar as etapas desse Codelab aos poucos, se quiser. Cada etapa ir√° ensinar a voc√™ algo novo para voc√™
          utilizar. E se voc√™ quiser parar em determinada parte e depois voltar para continuar, tudo bem. Os progressos s√£o
          independentes.
        </p>
      </aside>
    </google-codelab-step>


    <google-codelab-step label="Come√ßando" duration="3">
      <p>Vamos come√ßar baixando o c√≥digo-fonte do <strong>Dragotchi</strong> e configurar nosso ambiente de desenvolvimento.</p>
      <h2>O que voc√™ precisa</h2>
      <p>Clone o reposit√≥rio do GitHub usando a seguinte linha de comando:</p>
      <pre>$ git clone https://github.com/googlecodelabs/migrate-to-progressive-web-apps.git</pre>
      <aside class="special">
        <p>Esse comando ir√° criar uma pasta chamada <strong><em>migrate-to-progressive-web-apps</em></strong> que conter√° todo
          o c√≥digo fonte de cada etapa deste Codelab, como se fosse nosso gabarito. N√≥s iremos utilizar a pasta <strong><em>work</em></strong>          para escrever o c√≥digo aplicado para cada etapa.</p>
      </aside>
      <p>Uma vez que todo c√≥digo estiver salvo localmente, voc√™ deve usar <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb?hl=en"
          target="_blank">uma aplica√ß√£o que crie um Servidor HTTP</a> (ou equivalente de linha de commando, usando por exemplo
        Python) para levantar um servidor na pasta <strong><em>work</em></strong>, usando <a href="http://localhost:8887/"
          target="_blank">a porta 8887</a>.</p>
      <p>Voc√¢ agora pode abrir a url e brincar com o üê≤. N√£o se preocupe, o Codelab vai estar aqui quando voc√™ voltar.</p>

      <h2>Visitando seu site num dispositivo m√≥vel</h2>
      <p>Se voc√™ tem um dispositivo Android conectnado, voc√™ pode (no seu Chrome desktop) visitar o endere√ßo: <strong>chrome://inspect</strong>        (voc√™ vai precisar digitar ou copiar e colar esse endere√ßo). Ent√£o, configure um redirecionamento de porta (usando
        a mesma porta do seu servidor configurado anteriormente). A√≠ √© s√≥ salvar.</p>
      <p><img style="max-width: 183.50px" src="img/c8c4d97f348d4776.png"></p>

      <p>Agora voc√™ est√° apto para acessar a vers√£o b√°sica do <strong>Dragotchi</strong> em <a href="http://localhost:8887/"
          target="_blank">http://localhost:8887/</a> no seu dispositivo Android. Como j√° tinhamos discutido anteriormente,
        a vers√£o base n√£o √© otimizada para dispositivos m√≥veis‚Äî n√≥s iremos ver mais sobre isso no pr√≥ximo passo.</p>
      <aside class="special">
        <p>Se voc√™ n√£o tiver um Android em m√£os, voc√™ pode ter um preview de como o site se comportaria num dispositivo m√≥vel
          usando o Chrome Dev Tools. Para abrir, aperte ‚åò-‚å•-J (ou Ctrl-Shift-i) e clique num pequeno √≠cone na barra de navega√ß√£o
          (que parece um tablet com um celular), ao lado de "Elementos".</p>
      </aside>
    </google-codelab-step>



    <google-codelab-step label="Tags modernas no cabe√ßalho" duration="4">
      <p>A primeira coisa que iremos fazer nesse site "retr√¥" √© fazer com que ele fique mais amig√°vel para dispositivos m√≥veis,
        al√©m de incluir um arquivo que √© o chamado "Web App Manifest". Esse arquivo descreve metadados sobre o site, como
        por exemplo, o nome e o √≠cone com que ele vai aparecer na home screen do usu√°rio.</p>

      <p>O <strong>Dragotchi</strong> possui tr√™s p√°ginas HTML. Como ele n√£o utiliza nenhum framework nem templating system,
        voc√™ vai precisar editar o conte√∫do do &lt;head&gt; tanto no index.html, omo no faq.html e dragon.html</p>
      <pre>&lt;head&gt;
  &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, user-scalable=no&#34; /&gt;
  &lt;link rel=&#34;manifest&#34; href=&#34;manifest.json&#34; /&gt;
&lt;/head&gt;</pre>
      <p>Se voc√™ estiver sem tempo, voc√™ pode adiciona-las apenas no index.html para este codelab. Por√©m tenha ci√™ncia que em
        sites "reais" voc√™ precisa adicionar esse conte√∫do em todas as p√°ginas.</p>

      <h2>O viewport</h2>
      <p>A primeira linha √© a tag <code>meta</code>, que especifica o viewport. Voc√™ pode saber mais sobre viewport acessando
        <a href="https://developer.mozilla.org/pt-BR/docs/Mozilla/Mobile/Viewport_meta_tag" target="_blank">esse artigo no MDN</a>.
        Mas por agora, se voc√™ atualizar o seu site (seja no seu Android, seja no Developer Tools) voc√™ ir√° perceber que
        a p√°gina ir√° renderizar devidamente, sendo responsiva ao tamanho da tela do dispositivo.</p>

      <h2>O Web App Manifest</h2>
      <p>A segunda linha adiciona o <a href="https://www.google.com/search?q=web+app+manifest" target="_blank">Web App Manifest</a>,
        que √© necess√°rio para controlar como seu site ser√° adicionado √† tela inicial do usu√°rio. No c√≥digo, voc√™ j√° fez a
        refer√™ncia ao arquivo, agora vamos cria-lo!</p>

      <p>Abra seu editor de texto favorito. N√≥s iremos escrever um pouco de JSON. Vamos fazer algo mais ou menos assim-</p>

      <pre>{
  &#34;name&#34;: &#34;O melhor site de Drag√µes da Internet&#34;,
  &#34;short_name&#34;: &#34;üêâüêâüêâ&#34;,
  &#34;display&#34;: &#34;minimal-ui&#34;,
  &#34;start_url&#34;: &#34;/&#34;,
  &#34;theme_color&#34;: &#34;#673ab6&#34;,
  &#34;background_color&#34;: &#34;#111111&#34;,
  &#34;icons&#34;: [
    {
      &#34;src&#34;: &#34;icon-192.png&#34;,
      &#34;sizes&#34;: &#34;192x192&#34;,
      &#34;type&#34;: &#34;image/png&#34;
    }
  ]
}</pre>

      <p>O campo <code>short_name</code> especifica extamente o que aparece na tela inicial do usu√°rio. Tente manter esse campo
        pequeno, preferencialmente uma palavra √∫nica (se a palavra tiver mais de 15 caracteres, ela pode ser abreviada).
        No nosso caso, n√≥s utilizamos os emojis de drag√µes pois, igual a qualquer outro caracter, eles s√£o totalmente v√°lidos!
      </p>
      <p>Algumas coisas que valem a pena ser relembradas-</p>
      <ul>
        <li>O Chrome e outros navegadores s√£o particulamente detalhistas quanto a estrutura desse JSON. Tenha certeza que voc√™
          est√° usando sempre aspas duplas
        </li>
        <li>Normalmente, voc√™ deveria especificar mais √≠cones para tamanhos diferentes para cada tipo de tela. N√£o √© raro de
          um √≠cone enorme aparecer mal renderizado em telas menores.
        </li>
        <li>Existem outras propriedades que voc√™ pode adicionar, <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest"
            target="_blank">veja quais aqui</a></li>
      </ul>
      <p>Salve esse arquivo como <strong>manifest.json</strong>. Recarregue a p√°gina no seu Android, v√° no menu do Chrome e
        selecione a op√ß√£o "Adicionar √† Tela Inicial" Agora voc√™ dever√° ver um amig√°vel drag√£o na sua tela inicial!</p>
      <p><img style="max-width: 138.38px" src="img/ab4143d0c41f1545.png"></p>
      <p>Se voc√™ n√£o tiver um dispostivo Android por perto, selecione a aba "Aplica√ß√£o" dentro do painel do Chrome Developer
        Tools. Ent√£o, elecione &#34;Manifesto&#34; para ver os detalhes do mesmo. Se voc√™ ver uma mensagem como &#34;Nenhum
        manifesto detectado&#34;, verifique se o arquivo manifest.json que voc√™ criou foi salvo corretamente na pasta &#39;work&#39;.</p>
      <h2>Eita! Funcionou tudo lindo!</h2>
      <p>Sim, top demais.Agora vamos adicionar um Service Worker!</p>


    </google-codelab-step>












    <google-codelab-step label="Service Worker" duration="4">
      <aside class="special">
        <p>O c√≥digo final dessa etapa est√° na pasta <strong><em>migrate-to-progressive-web-apps/step4-sw</em></strong>.</p>
      </aside>
      <p>Um <a href="https://www.google.com/search?q=service+worker" target="_blank">Service Worker</a> √© um script que roda
        em segundo plano no navegador. Ele √© t√£o poderoso que ele consegue ser executado at√© quando sua p√°gina n√£o est√° em
        primeiro plano. Com ele, podemos prover aos usu√°rios funcionalidades como suporte Offline e notifica√ß√µes Push.</p>
      <p>At√© um Service Worker vazio pode ajudar seu site. Como √© que eu implemento essa belezura? Continue lendo.</p>
      <h2>Adicionando o Service Worker</h2>
      <p>Primeiramente, n√≥s iremos escrever um pouco de JavaScript. Vamos copiar o m√≠nimo de c√≥digo em um novo arquivo-</p>
      <pre>/** Um service worker que n√£o faz nada! */
self.addEventListener(&#39;fetch&#39;, function(event) {
  /** Um listener que n√£o faz nada! */
});</pre>
      <p>Salve isso como <strong>sw.js</strong>! √â isso, est√° feito! Voc√™ criou o seu primeiro service worker! üéÜ</p>

      <h2>Registrando o seu Service Worker</h2>
      <p>Bem, tem mais uma etapa. O c√≥digo acima e o arquivo (sw.js) n√£o est√£o sendo referenciados em lugar nenhum (os navegadores
        atuais s√£o √≥timos, mas ainda n√£o adivinham as coisas). Voc√™ vai precisar declara-lo no seu c√≥digo para o navegador
        reconhecer o seu service worker.</p>
      <p>O <strong>Dragotchi</strong> j√° possui no seu c√≥digo um script que executa em todas as p√°ginas. Abra o arquivo site.js
        e adicione o c√≥digo a seguir-</p>
      <pre>navigator.serviceWorker &amp;&amp; navigator.serviceWorker.register(&#39;./sw.js&#39;).then(function(registration) {
  console.log(&#39;SW funcionando, registrado com o escopo: &#39;, registration.scope);
});</pre>
      <p>√â isso! Esse c√≥digo vai executar a cada carregamento de p√°gina. Se o service worker j√° estiver registrado seu navegador
        vai ignorar a requisi√ß√£o de registro e depois de algum tempo, ir√° verificar se alguma coisa mudou.</p>
      <p>Recarregue sua p√°gina e verifique em <code>chrome://serviceworker-internals/</code> se o Service Worker est√° de fato
        carregado para o site. Vai parecer algo mais ou menos assim-</p>
      <p><img style="max-width: 624.00px" src="img/55d50a8c457504e.png"></p>
      <h2>Fant√°stico, o que eu posso fazer com isso?</h2>
      <p>Primeiramente (e provavelmente, o mais top) √© que seu site agora ir√°, sozinho, <em>perguntar</em> aos usu√°rios se eles
        desejam instalar seu PWA na tela inicial. Para saber mais como isso funciona, leia esse <a href="https://developers.google.com/web/updates/2015/03/increasing-engagement-with-app-install-banners-in-chrome-for-android?hl=en"
          target="_blank">artigo do Google Developers</a> (em ingl√™s).</p>
      <p><img style="max-width: 137.50px" src="img/ecb9f92bf435c1a2.png"></p>
      <p>Por fim, voc√™ pode expandir as capacidades do seu service worker para que ele possibilite o acesso offline na sua aplica√ß√£o,
        bem como permite com que seus usu√°rios recebam notifica√ß√µes. Continue lendo para saber como isso funciona!</p>

    </google-codelab-step>











    <google-codelab-step label="Enviando notifica√ß√µes Push" duration="10">
      <aside class="special">
        <p>O c√≥digo final dessa etapa est√° na pasta <strong><em>migrate-to-progressive-web-apps/step5-push</em></strong>, mas
          ainda sim voc√™ ir√° precisar alterar a sua
          <code>publicKey</code> dentro do arquivo &#34;site.js&#34; (durante essa etapa voc√™ ir√° aprender a conseguir uma
          publicKey).</p>
      </aside>


      <p>Vamos enviar notifica√ß√µes! N√≥s n√£o iremos desenvolver um servidor para enviar as mensagens, mas iremos deixar tudo
        pronto na parte do front-end do site, assim iremos conseguir testar as notifica√ß√µes sem problemas.</p>

      <p>Voc√™ vai precisar de duas chaves, uma chave p√∫blica e a outra privada. Acesse o site <a href="https://web-push-codelab.appspot.com/"
          target="_blank">Push Companion</a>que ele vai gerar as chaves pra voc√™, e vamos usa-las em breve. Mas aten√ß√£o: voc√™
        precisa manter o site aberto para que as chaves permane√ßam ativas.</p>

      <aside class="warning">
        <p><strong>Importante</strong>: Nunca inclua sua chave privada no seu HTML ou no c√≥digo de um reposit√≥rio p√∫blico. Se
          voc√™ deixar sua chave aberta, outras pessoas podem utiliza-la e comprometer o seu site.</p>
      </aside>

      <h2>Inscrevendo-se para receber pushs</h2>
      <p>Dentro do c√≥digo do seu site, voc√™ ir√° criar uma se√ß√£o para que o usu√°rio se inscreva para receber notifica√ß√µes. √â
        bem simples. Vamos adicionar o seguinte c√≥digo no arquivo site.js-</p>
      <pre>navigator.serviceWorker &amp;&amp; navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {  
  serviceWorkerRegistration.pushManager.getSubscription()  
    .then(function(subscription) {  
      // subscription ser√° null ou um objeto PushSubscription
    });
});</pre>

      <p>Se <code>subscription</code> retornar <code>null</code>, ent√£o n√≥s precisamos adicionar um bloco de c√≥digo para que
        o usu√°rio tenha a possibilidade de fazer a inscri√ß√£o-</p>

      <pre>      if (subscription) {
        console.info(&#39;O usu√°rio j√° est√° inscrito&#39;, subscription);
        window.subscription = subscription;
        return
      }

      const applicationServerKey = urlB64ToUint8Array(publicKey);
      serviceWorkerRegistration.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey,
      })
        .then(function(subscription) { 
          console.info(&#39;Usu√°rio acabou de se inscrever!&#39;, subscription);
          window.subscription = subscription;
        });</pre>

      <p>Primeiramente, note que a <code>publicKey</code> n√£o est√° definida em lugar nenhum. Crie ela no in√≠cio do arquivo,
        usando a chave que voc√™ obteve no site
        <a href="https://web-push-codelab.appspot.com/" target="_blank">Push Companion</a> mais vedo-</p>
      <pre>const publicKey = &#39;&lt;sua public key retirada do Push Companion&gt;&#39;;</pre>
      <p>Voc√™ agora est√° apto para salvar seu arquivo e recarregar sua p√°gina - tanto no desktop como no Android, n√£o importa
        qual. Se voc√™ der uma olhada no seu Console dentro do Developer Tools, voc√™ ir√° ver uma mensagem com o objeto da
        inscri√ß√£o. Nele est√° continudo um campo &#34;endpoint&#34;. N√≥s iremos usar isso em breve, ent√£o deixe a janela aberta.</p>
      <p><img style="max-width: 624.00px" src="img/d28fcbe6a6e1fa4.png"></p>
      <p>Se voc&e ver um erro, certifique-se que sua <code>publicKey</code> est√° salva devidamente, ela parece uma string codificada
        em base64.</p>
      <aside class="warning">
        <p><strong>Importante</strong>: para a demonstra√ß√£o (ou seja, no modo debug) se inscrever-se em notifica√ß√µes simplesmente
          ao acessar a p√°gina √© OK. Por√©m isso pode surpreender os seus usu√°rios, e eles dir√£o que n√£o pois n√£o est√£o confort√°veis
          com essa situa√ß√£o‚Äîalgumas pesquisas do Google mostram que a convers√£o de usu√°rios √© incrivelmente maior quando
          existe uma a√ß√£o envolvida, como por exemplo clicar num bot√£o "Inscreva-se".</p>
      </aside>



      <h2>Exibindo a notifica√ß√£o</h2>
      <p>√â legal se inscrever para receber notifica√ß√ïes, mas mais legal ainda √© recebe-las. Mas, o que acontece? Como funciona?
        O usu√°rio nem sempre vai estar com o <strong>Dragotchi</strong> aberto... e √© ai que o Service Worker entra. Se voc√™
        estiver bem lembrado, um service worker continua funcionando, mesmo que o site n√£o esteja aberto.</p>
      <p>Vamos abrir o arquivo sw.js ae adicionar essa se√ß√£o-</p>
      <pre>self.addEventListener(&#39;push&#39;, function(event) {
  event.waitUntil(
    self.registration.showNotification(&#39;Got Push?&#39;, {
      body: &#39;Push Message received&#39;
   }));
});</pre>
      <p>Essa √© uma das mais simples notifica√ß√µes poss√≠veis que podem ser exibidas, apenas com t√≠tulo e mensagem. Para mais
        op√ß√µes, d√™ uma olhada na <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification"
          target="_blank">documenta√ß√£o</a>. Por agora, recarregue a p√°gina para que isso seja carregado no seu site.</p>


      <h2>Misturando tudo</h2>
      <p>Voltando ao Chrome Developer Tools no seu desktop. N√≥s iremos chamar uma fun√ß√£o que irar gerar um comando para voc√™
        enviar uma notifica√ß√£o. Voc√™ ir√° precisar ter o &#34;curl&#34; instalado na sua m√°quina. Em sistemas Mac ou Linux,
        o &#34;curl&#34; j√° est√° instalado por padr√£o.</p>
      <p>Copie o c√≥digo a seguir e cole ele no console dentro do Chrome Developer Tools-</p>
      <pre>var privateKey = window.prompt(&#39;Insira sua privateKey&#39;);
privateKey &amp;&amp; prepareAuthorization(publicKey, privateKey, subscription.endpoint, &#39;mailto:example@example.com&#39;).then(auth =&gt; {
  const curl = `curl &#34;${subscription.endpoint}&#34; ` +
      `-X POST ` +
      `-H &#34;Authorization: ${auth}&#34; ` + 
      `-H &#34;Crypto-Key: p256ecdsa=${publicKey}&#34; ` +
      `-H &#34;TTL: 100&#34; ` +
      `-H &#34;Content-Length: 0&#34;`;
  console.warn(&#39;Copie e cole o conte√∫do a seguir na linha de comando-&#39;);
  console.dir(curl);
});</pre>

      <p>Ao executar o c√≥digo acima, ele ir√° imediatamente perguntar sobre a sua privateKey que voc√™ obteve usando o <a href="https://web-push-codelab.appspot.com/"
          target="_blank">Push Companion</a>. Cole a chave no campo e perte OK. Depois disso, o console ir√° exibir uma linha
        de c√≥digo enorme. D√™ um duplo clique nela, copie-a, cole na linha de comando e execute.</p>

      <aside class="warning">
        <p><strong>Importante</strong>: O c√≥digo que voc√™ acabou de executar usa o objeto subscription, que voc√™ normalmente
          envia para o seu servidor para executar e preparar a requisi√ß√£o push. O exemplo aqui utilizado √© apenas uma base
          do que voc√™ precisa implementar no seu servidor para enviar as mensagens corretamente.
      </aside>



      <h2>E pronto!</h2>
      <p>Voc√™ deve ver algo mais ou menos assim no seu desktop. Bom trabalho!</p>
      <p><img style="max-width: 624.00px" src="img/e5cc4493bb3c5e8f.png"></p>
      <p>Esse √© o exemplo mais b√°sico poss√≠vel. O endpoint gerado pode (e deve) ser enviado para um servidor, num servi√ßo que
        pode executar as notifica√ß√µes a qualquer momento, at√© quando seu site n√£o estiver disponivel.</p>


    </google-codelab-step>














    <google-codelab-step label="Acesso Offline" duration="5">
      <aside class="special">
        <p>O c√≥digo final dessa etapa est√° na pasta <strong><em>migrate-to-progressive-web-apps/step6-cache </em></strong><em>(entretanto, ele n√£o tem o bloco de c√≥digo com notifica√ß√µes Push)</em>.</p>
      </aside>

      <p>Vamos criar um novo Service Worker para permitir que o <strong>Dragotchi</strong> seja acessado offline. Primeiramente,
        vamos abrir o arquivo sw.js de novo. Nosso objetivo aqui √© que controlar o <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache"
          target="_blank">cache do navegador</a>, ent√£o no nosso service worker fazemos o seguinte-</p>
      <pre>self.addEventListener(&#39;install&#39;, function(e) {
  e.waitUntil(
    caches.open(&#39;the-magic-cache&#39;).then(function(cache) {
    });
  );
});</pre>
      <p>Agora, uma vez que n√≥s estamos controlando isso, vamos atualizar o c√≥digo para adicionar nosso site inteiro ao cache-</p>
      <pre>self.addEventListener(&#39;install&#39;, function(e) {
  e.waitUntil(
    caches.open(&#39;the-magic-cache&#39;).then(function(cache) {
      return cache.addAll([
        &#39;/&#39;,
        &#39;/index.html&#39;,
        &#39;/dragon.html&#39;,
        &#39;/faq.html&#39;,
        &#39;/manifest.json&#39;,
        &#39;/background.jpeg&#39;,
        &#39;/construction.gif&#39;,
        &#39;/dragon.png&#39;,
        &#39;/logo.png&#39;,
        &#39;/site.js&#39;,
        &#39;/dragon.js&#39;,
        &#39;/styles.css&#39;,
      ]);
    })
  );
});</pre>
      <p>Essa lista √© bem grande, mas √© importante que seja. Se voc√™ usar algum processo de empacotamento/gerador para o seu
        site, ent√£o √© interessante que voc√™ adicione automaticamente todas as URLs poss√≠veis que seu usu√°rio possa acessar.</p>

      <h2>Fazendo um "match" nas requisi√ß√µes</h2>

      <p>At√© agora t√° tudo muito bom, t√° tudo muito bem, mas realmente o que a gente quer √© que quando o usu√°rio acesse o nosso
        site offline, ele continue funcionando. At√© agora n√≥s apenas listamos quais arquivos devem estar no cache, mas s√≥
        agora n√≥s iremos escrever a parte do c√≥digo em que n√≥s entregamos esses arquivos para o usu√°rio. N√≥s iremos subistituir
        o listener &#39;fetch&#39; que est√° dentro do sw.js-</p>
      <pre>self.addEventListener(&#39;fetch&#39;, function(event) {
  event.respondWith(
    caches.match(event.request).then(function(response) {
      return response || fetch(event.request);
    })
  );
});</pre>
      <p>O objeto que representa o cache ir√° executar um "match" com sua requisi√ß√£o, retornando uma resposta v√°lida ou <code>null</code>.
        Se o valor for nulo, ent√£o n√≥s entregamos [class]=" requisi√ß√£o para o m√©todo <a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch"
          target="_blank"><code>fetch</code></a> fazer a requisi√ß√£o normalmente.</p>
      <p>Voc√™ pode escrever "matchs" mais complexos. Esses dois blocos de c√≥digo representam um cache simples, voc√™ armazena
        os objetos pela URL e acessa eles pela URL. Entretanto, n√£o tem nada que impe√ßa voc√™ de executar um JavaScript mais
        robusto no seu service worker. N√≥s iremos ver um pouco sobre isso mais √† frente.</p>

      <h2>Testando</h2>
      <p>V√° at√© o seu Android e desistale o <strong>Dragotchi</strong> da sua tela inicial. Ent√£o, abra ele no Chrome, recarregue
        a p√°gina e depois adicione-o √† sua tela inicial mais uma vez.</p>
      <p>Se voc√™ desconectar seu Android do USB e apertar no √≠cone do <strong>Dragotchi</strong>, repare que ele continua carregando!
        Voc√™ pode at√© recarregar a p√°gina, tudo continua a funcionar.</p>

      <h2>Alguns detalhes importantes</h2>
      <p>Esse tipo de cache cache vai armazenar seu site pra sempre!*</p>
      <p>*ou at√© o armazenamento do usu√°rio ficar cheio</p>

      <p>Isso n√£o √© muito legal. Isso significa que a cada mudan√ßa que voc√™ fizer na sua p√°gina, voc√™ necessariamente precisa
        limpar seu Service Worker para ver a altera√ß√£o.</p>

      <p>De agora em diante, no nosso projeto, acesse <a href="http://localhost:8887/clear.html" target="_blank">http://localhost:8887/clear.html</a>        e aperte o bot√£o &#34;Clear&#34;. Essa p√°gina serve como um auxiliar para ajudar voc√™ a limpar o cache do service
        worker que √© executado em todo evento de "install".</p>

      <p>Isso pode ser bem frustrante, pois precisa ser feito a cada mudan√ßa na p√°gina. Esse √© o motivo que estamos fazendo
        isso por √∫ltimo nesse codelab.</p>

      <p>Se quiser dar uma olhada de uma maneira mais profunda, acesse o projeto <a href="https://workboxjs.org/" target="_blank">Workbox</a>,
        que √© uma cole√ß√£o de bibliotecas que auxiliam voc√™ a desenvolver um Service Worker mais robusto.</p>

      <aside class="warning">
        <p><strong>Importante</strong>: Se voc√™ n√£o tiver uma estrat√©gia clara em rela√ß√£o ao cache, isso pode afetar seriamente
          o desenvolvimento do seu site bem como os seus usu√°rios. Pode acontecer de eles <strong>nunca</strong> acessarem
          uma vers√£o mais atual do seu website se algo n√£o for planejado corretamente.</p>
      </aside>

      <p>A regra b√°sica √©: se o seu Service Worker mudar, quando uma p√°gina do seu site recarregar, ele ser√° reinstalado. Durante
        o desenvolvimento, voc√™ pode adicionar um simples coment√°rio que cont√©m a vers√£o do seu Service Worker. Toda vez
        que ela mudar, o evento de instala√ß√£o ir√° ocorrer de novo, e ele ir√° fazer o cache novamente de todos os arquivos
        que voc√™ possa ter mudado. Adicione esse coment√°rio no topo do arquivo sw.js file-</p>
      <pre>// version: Estou quase acabando o codelab!</pre>
      <p>Voc√™ pode imaginar que ao inv√©s de fazer isso manualmente, o versionamento deve ser feito usando algum processo automatizado
        na constru√ß√£o do seu site.</p>

      <h2>T√° quase</h2>
      <p>Se voc√™ carregou o site mesmo com o USB desconectado e tentou cuidar do seu drag√£o, isso s√≥ funcionou por qu√™ seu dispositivo
        ainda est√° online. N√≥s cacheamos apenas as p√°ginas que correspondem o nosso pr√≥prio site.</p>
      <p>Se voc√™ tentar fazer isso com o modo avi√£o, por exemplo, apesar das p√°ginas locais funcionarem, voc√™ vai receber um
        <code>alert</code> indicando a falha na conex√£o com o servidor externo. Vamos resolver isso.</p>
      <p><img style="max-width: 383.14px" src="img/1fb35df293784c9c.png"></p>

    </google-codelab-step>








    <google-codelab-step label="Cache Imperativo" duration="4">
      <aside class="special">
        <p>O c√≥digo final dessa etapa est√° na pasta <strong><em>migrate-to-progressive-web-apps/step7-imperative</em></strong><em>(entretanto, ele n√£o tem o bloco de c√≥digo com notifica√ß√µes Push)</em>.</p>
      </aside>

      <p>Como mencionamos anteriormente, tem muito mais coisas que voc√™ pode fazer usando o Cache dispon√≠vel no Service Worker.
        Vamos gerenciar agora um URL externo a nosso projeto. O status do seu drag√£o vem de um site externo, ent√£o n√≥s podemos
        interceptar a conex√£o.</p>
      <p>Dentro do blogo fetch no sw.js, vamos buscar por requisi√ß√µes que venham especificamente de uma URL-</p>
      <pre>self.addEventListener(&#39;fetch&#39;, function(event) {
  if (event.request.url == &#39;https://dragon-server.appspot.com/&#39;) {
    return;
  }
  /** c√≥digo antigo */
});</pre>
      <p>Isso mostra que um Service Worker pode interceptar requisi√ß√µes em dom√≠nios externos ao seu pr√≥prio site. Agora, vamos
        fazer alguma coisa com essa URL-</p>
      <pre>  if (event.request.url == &#39;https://dragon-server.appspot.com/&#39;) {
    console.info(&#39;respondendo a requisi√ß√£o ao dragon-server via Service Worker! ü§ì&#39;);
    event.respondWith(fetch(event.request).catch(function(e) {
      let out = {Gold: 1, Size: -1, Actions: []};
      return new Response(JSON.stringify(out));
    }));
    return;
  }</pre>

      <p>Isso ir√° retornar uma respsota v√°lida, por√©m limitada, quando existe uma chamada a esse servidor externo quando o site
        estiver offline (veja o bloco <code>catch</code> nessa <code>Promise</code>). Esse codelab tem a inten√ß√£o de dar
        uma introdu√ß√£o r√°pida, existem muitas mais alternativas para esse tipo de fallback. Voc√™ pode dar uma olhada em como
        armazenar dados offline usando coisas como o <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API"
          target="_blank">IndexedDB</a>.</p>

      <p>A chave aqui √© mostrar que √© possivel voc√™ ter total controle de qualquer requisi√ß√£o que voc√™ fizer, em qualquer contexto.</p>

      <h2>Testando</h2>
      <p>Como comentamos anteriormente, a primeira coisa a se fazer √© limpar o cache. Visite <a href="http://localhost:8887/clear.html"
          target="_blank">http://localhost:8887/clear.html</a> para limpar. Ent√£o, remova o app da tela inicial e reinstale-o,
        usando o mesmo processo de sempre.</p>

      <p>Ative o modo avi√£o e ent√£o abra o site pelo √≠cone, e navegue para a p√°gina do <strong>Dragotchi</strong>. Repare que
        o estado padr√£o est√° com os valores que voc√™ definiu via o Service Worker!</p>
      <p><img style="max-width: 320.50px" src="img/2d9ffaf6e7e4124f.png"></p>


    </google-codelab-step>

    <google-codelab-step label="Est√° feito!" duration="1">
      <h2>Parab√©ns</h2>
      <p>Voc√™ aprendeu um monte sobre como deixar seu site um pouco mais progressivos, at√© aqueles sites que parecem estar presos
        nos anos 90!</p>

      <p>Agora, que tal acessar outros codelabs?</p>

      <!--, be sure to try out many of the <a href="https://codelabs.developers.google.com/" target="_blank">other codelabs</a>,
        which will go into more detail on all of these topics. Or read more on <a href="https://github.com/slightlyoff/ServiceWorker/blob/master/explainer.md"
          target="_blank">Service Worker</a> and <a href="http://blog.chromium.org/2015/04/reaching-and-re-engaging-users-on.html"
          target="_blank">Push Notifications</a>.</p-->

      <p>ü§ò</p>


    </google-codelab-step>

  </google-codelab>

</body>

</html>